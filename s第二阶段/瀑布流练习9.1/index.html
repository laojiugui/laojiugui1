<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>瀑布流</title>
    <style>
        #container{
            position:relative;
            margin:0 auto;
        }
        .box{
            padding:5px;
            float:left;
        }
        .item{
            padding:5px;
            border:1px solid red;
            border-radius:5px;
            box-shadow:5px 5px 5px 5px #ccc;
        }
        img{
            width:300px;
            height:auto;
        }
    </style>
    <script src="jquery-1.12.4.min.js"></script>
    <script>
        $(function(){
            $(window).on("load",function(){
                oImg();
            }) ;

            function oImg(){
                //获取所有图片
                var $imgs=$(".box");
                //获取当前窗口宽度
                var $width=$(document).width();
                //计算一行能放多少图片
                var $num=Math.floor($width/$imgs.eq(0).outerWidth());
                //设置容器的宽度
                $("#container").css(
                        {"width":$num*$imgs.eq(0).outerWidth(),
                            "margin":"auto"
                        }
                );
                //循环存放
                var $rowHeight=[];
                $imgs.each(function(index){
                    //保存第一行图片的数组
                    if(index<$num){
                        $rowHeight[index]=$imgs.eq(index).outerHeight();
                    }else{
                        //第二行图片开始定位数组
                        var minHeight=Math.min.apply(null,$rowHeight);
                        var minIndex=$.inArray(minHeight,$rowHeight);
                        //图片定位
                        $imgs.eq(index).css({
                            "position":"absolute",
                            "left":$imgs.eq(minIndex).position().left,
                            "top":minHeight
                        });
                        $rowHeight[minIndex]+=$imgs.eq(index).outerHeight();
                    }
                })
            }

            var jsonImg = {data:[{"src":"img/1.jpg"},{"src":"img/2.jpg"},{"src":"img/3.jpg"},{"src":"img/4.jpg"},
                {"src":"img/5.jpg"},{"src":"img/6.jpg"},{"src":"img/7.jpg"},{"src":"img/8.jpg"},
                {"src":"img/9.jpg"},{"src":"img/10.jpg"},{"src":"img/11.jpg"},{"src":"img/12.jpg"},{"src":"img/13.jpg"},
            {"src":"img/14.jpg"},{"src":"img/15.jpg"},{"src":"img/16.jpg"},{"src":"img/17.jpg"},{"src":"img/18.jpg"}]};

            $(window).on("scroll",function(){
                if(loadFlag()){
                    $.each(jsonImg.data,function(index,value){
                        console.log($(value).attr("src"));
                        var $iDiv=$("<div>").addClass("box").appendTo("#container");
                        var $nDiv=$("<div>").addClass("item").appendTo($iDiv);
                        var $nImg=$("<img>").attr("src",$(value).attr("src")).appendTo($nDiv);

                    });
                    oImg();
                }
            });

            function loadFlag(){
                var $stop=$(window).scrollTop()+$(".box").last().outerHeight()+500;
                var $nHeight=$(".box").last().offset().top;

                return ($stop>$nHeight)?true:false;
            }

        });
    </script>
</head>
<body>
<div id="container">
    <div class="box">
        <div class="item">
            <img src="img/1.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/3.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/4.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/5.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/6.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/7.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/8.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/9.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/10.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/11.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/12.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/13.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/14.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/15.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/16.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/17.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/18.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/19.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/20.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/17.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/18.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/19.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/20.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/17.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/18.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/19.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/20.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/17.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/18.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/19.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/20.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/17.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/18.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/19.jpg">
        </div>
    </div>
    <div class="box">
        <div class="item">
            <img src="img/20.jpg">
        </div>
    </div>
</div>
</body>
</html>